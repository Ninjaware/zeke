Build System
============

Kernel Build
------------

`kern/Makefile` is responsible of compiling the kernel and parsing kmod
makefiles. Module makefiles are following the naming convention
`<module>.mk` and are located under `kern/kmodmakefiles` directory.

Module makefiles are parsed like normal makefiles but care should be
taken when changing global variables in these makefiles. Module
makefiles are mainly allowed to only append `IDIR` variable and all
other variables should be more or less specific to the module makefile
itself and should begin with the name of the module.

An example of a module makefile is shown in listing
[\[list:modulemk\]](#list:modulemk).

```makefile
# Module example
# Mandatory file
# If any source files are declared like this the whole module becomes
# mandatory and won't be dropped even if its configuration is set to zero.
module-SRC-1 += src/module/test.c
# Optional file
# If all files are declared like this then the module is optional and can be
# enabled or disabled in the `config.mk`.
module-SRC-$(configMODULE_CONFIGURABLE) += src/module/source.c
# Assembly file
module-ASRC$(configMODULE_CONFIGURABLE) += src/module/lowlevel.S
```

The kernel makefile will automatically discover `test-SRC-1` list and
will compile a new static library based on the compilation units in the
list. Name of the library is derived from the makefileâ€™s name and so
should be the first word of the source file list name.

Userland Build
--------------

Userland makefiles are constructed from `user_head.mk`, `user_tail.mk`
and the actual targets between includes. A good example of a user space
makefile is `bin/Makefile` that compiles tools under `/bin`. A manifest
file is automatically generated by the make system and it will be used
for creating a rootfs image with `tools/mkrootfs.sh` script.

Libraries
---------

TODO

Applications
------------

TODO

Tools Build
-----------

TODO
